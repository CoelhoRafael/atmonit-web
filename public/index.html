<!DOCTYPE html>
<html>

<head>
	<title>AtMonit - Login</title>
	<link rel="stylesheet" type="text/css" href="css/style-login.css">
	<link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
	<!-- Substituir a imagem do sortcut icon para uma versão em png -->
	<link rel="sortcut icon" href="img/authentication.svg" type="image/svg" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">

	<script src="./js/funcoes.js"></script>

</head>

<body>
	<div class="container">
		<div class="contact-box">
			<div class="left">
				<img src="img/atmonit.svg" class="img">
				<br>
				<p class="logo-sub">© Developed by Monilog </p>
			</div>
			<div class="right">
				<h2>Faça Login</h2>
				<form id="form_login" method="post" onsubmit="return login()">
					<input name="email" type="text" class="inpt" placeholder="Email">
					<input name="password" type="password" class="inpt" placeholder="Insira sua senha">
					<button type="submit" class="btn">Entrar</button>
					<a class="link" href="#">Não Consegue Acessar?</a>
				</form>
			</div>
		</div>
	</div>
</body>

</html>


<script>

	function limparFormulario() {
		document.getElementById("form_login").reset();
	}

	function login() {
		// aguardar();

		var form = new URLSearchParams(new FormData(document.getElementById("form_login")));

		var email = form.get("email");
		var password = form.get("password");

		console.log("FORM LOGIN: ", email);
		console.log("FORM SENHA: ", password);

		// TODO: VERIFICAR AS VALIDAÇÕES QUE ELES ESTÃO APRENDENDO EM ALGORITMOS 
		if (email == "" || password == "") {
			window.alert("Preencha todos os campos para prosseguir!");
			// finalizarAguardar();
			return false;
		}

		// if (email.indexOf("@") == -1 || email.indexOf(".com") == -1) {
		// 	window.alert("Ops, e-mail inválido! Verifique e tente novamente.");
		// 	// finalizarAguardar();
		// 	return false;
		// }

		fetch("/usuarios/autenticar", {
			method: "POST",
			body: form
		}).then(function (response) {

			if (response.ok) {
				console.log(response);
				response.json().then(json => {
					console.log(json);
					console.log(JSON.stringify(json));

					sessionStorage.NOME_USER = json.employee_name;
					sessionStorage.ID_USER = json.id_employee;
					sessionStorage.ID_COMPANY = json.fk_company;
					sessionStorage.OFFICE = json.office;

					
					setTimeout(function () {
						window.location = "./home.html";
					}, 1000); // apenas para exibir o loading

				});

			} else {

				console.log("Houve um erro ao tentar realizar o login!");

				response.text().then(texto => {
					console.error(texto);
					// finalizarAguardar(texto);
				});
			}

		}).catch(function (erro) {
			console.log(erro);
		})

		return false;
	}

</script>